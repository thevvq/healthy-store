extends ../../layouts/default.pug

block main
    // ----- KHỐI DANH MỤC (NẰM TRÊN SLIDER) -----
    .block-home-top
        .container
            .home.category
                .home.category-label
                    i.fa-solid.fa-bars
                    span Danh mục

                .home.category-wrapper
                    // Cột trái: danh mục CHA
                    ul.home.category-main
                        if categoriesMenu && categoriesMenu.length
                            each cat in categoriesMenu
                                // Cha: parent_category null / undefined / ""
                                if !cat.parent_category
                                    li.home.category-main-item(data-id=cat._id data-slug=cat.slug)
                                        span= cat.title
                                        i.fa-solid.fa-angle-right

                    // Cột phải: danh mục CON
                    .home.category-detail
                        if categoriesMenu && categoriesMenu.length
                            each parent in categoriesMenu
                                if !parent.parent_category
                                    .home.category-panel(data-id=parent._id)
                                        h3.home.category-title= parent.title
                                        ul.home.category-list
                                            each child in categoriesMenu
                                                // Con: parent_category === _id của cha
                                                if child.parent_category && child.parent_category == parent._id
                                                    li
                                                        a(href=`/products?category=${child.slug}`)= child.title

    // ----- SLIDER -----
    .slider
        .slides
            img(src="/images/slider1.jpg", alt="Slide 1")
            img(src="/images/slider2.jpg", alt="Slide 2")
            img(src="/images/slider3.jpg", alt="Slide 3")
        .dots

    // ----- SẢN PHẨM TẠI Verdish -----
    section.products-section
        .container
            h2.products-title Sản phẩm tại Verdish

            .products-tabs
                button.products-tab.active(type="button" data-filter="best") Bán chạy nhất
                button.products-tab(type="button" data-filter="new") Hàng mới về
                button.products-tab(type="button" data-filter="top") Đánh giá cao

            .products-list
                if productsHome && productsHome.length
                    each product, index in productsHome
                        - const catTab = index % 3 === 0 ? 'best' : (index % 3 === 1 ? 'new' : 'top');
                        .product-card(data-category=catTab)
                            .product-card-image
                                if product.thumbnail
                                    img(src=product.thumbnail, alt=product.title || product.name || 'Sản phẩm')
                                else
                                    img(src="/images/logo.svg", alt=product.title || product.name || 'Sản phẩm')
                            .product-card-body
                                h3.product-card-name= product.title || product.name || 'Chưa có tên'
                                if product.newPrice
                                    p.product-card-price #{Number(product.newPrice).toLocaleString('vi-VN')}đ
                                else if product.price
                                    p.product-card-price #{Number(product.price).toLocaleString('vi-VN')}đ
                else
                    p.text-muted.text-center Chưa có sản phẩm nào.

            .products-more
                a.products-more-btn(href="/products") Xem thêm sản phẩm →

block scripts
    script(src="/js/home.category.menu.js")
    script(src="/js/home.products.js")
    script(src="/js/slider.js")