extends ../../layouts/default

block main
    .container
        h2.mb-3 Chi tiết đơn hàng ##{order._id}

        p.text-muted Ngày đặt: #{order.createdAt.toLocaleString()}

        h4 Trạng thái hiện tại:
        span.badge(
            class= order.status === 'cancelled' ? 'bg-secondary' :
                   order.status === 'completed' ? 'bg-success' :
                   order.status === 'shipping' ? 'bg-info' :
                   order.status === 'confirmed' ? 'bg-primary' : 'bg-warning text-dark'
        ) #{order.statusText}

        hr

        h3 Thông tin giao hàng
        if order.shippingInfo
            p Tên: #{order.shippingInfo.name}
            p SĐT: #{order.shippingInfo.phone}
            p Địa chỉ: #{order.shippingInfo.address}
        else
            p.text-muted Không có thông tin giao hàng.

        hr

        h3 Sản phẩm
        table.table.table-bordered
            thead.table-light
                tr
                    th Ảnh
                    th Tên
                    th SL
                    th Giá
                    th Thành tiền
            tbody
                each item in order.items
                    tr
                        td
                            img(src=item.thumbnail, width="60", style="border-radius:6px;")
                        td #{item.title}
                        td #{item.quantity}
                        td $#{item.price}
                        td $#{(item.quantity * item.price).toFixed(2)}

        h3.mt-3
            | Tổng thanh toán: 
            span.text-danger $#{order.total.toFixed(2)}

        hr

        h3 Cập nhật trạng thái đơn

        form(method="POST", action=`/admin/orders/${order._id}/status`, style="max-width:300px;")
            select.form-select(name="status")
                option(value="pending", selected=order.status === 'pending') Đang xử lý
                option(value="confirmed", selected=order.status === 'confirmed') Đã duyệt
                option(value="shipping", selected=order.status === 'shipping') Đang giao
                option(value="completed", selected=order.status === 'completed') Hoàn tất
                option(value="cancelled", selected=order.status === 'cancelled') Đã hủy

            button.btn.btn-success.mt-3(type="submit") Lưu trạng thái

        a.btn.btn-secondary.mt-3.ms-2(href="/admin/orders") Quay lại danh sách
